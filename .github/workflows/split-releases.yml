name: Split releases

on:
  release:
    types: ['published']

concurrency:
  group: split

env:
  GH_TOKEN: ${{ secrets.SUBSPLIT_WRITE_ACCESS }}

jobs:
  split:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        package:
          - { folder: actor }
          - { folder: agent }
          - { folder: bootloader }
          - { folder: migration }
          - { folder: relay }
          - { folder: security }
          - { folder: terminal }
          - { folder: test }
          - { folder: views }
          - { folder: llm }
          - { folder: usage }
          - { folder: docs }
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: Publishing
        uses: wippyai/action-module-release@main
        with:
          directory: src/${{ matrix.package.folder }}
          tag: ${{ github.ref_name }}
          username: ${{ secrets.WIPPY_USERNAME }}
          password: ${{ secrets.WIPPY_PASSWORD }}
